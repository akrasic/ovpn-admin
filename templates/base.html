{{define "base"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ovpn-admin</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.2/dist/htmx.min.js"></script>
</head>
<body>
    <div class="container-fluid py-3">
        {{template "content" .}}
    </div>

    <!-- Modal container -->
    <div id="modal-container"></div>

    <!-- Toast container -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 start-0 p-3"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Cookie helper
        function getCookie(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
            return null;
        }

        function setCookie(name, value) {
            document.cookie = name + "=" + value + "; path=/; max-age=31536000";
        }

        // Toggle hide revoked filter
        function toggleHideRevoked() {
            const current = getCookie('hideRevoked') === 'true';
            setCookie('hideRevoked', !current);
            return true;
        }

        // Toast notification handler
        document.body.addEventListener("showToast", function(e) {
            const detail = e.detail;
            const toastHtml = `
                <div class="toast align-items-center text-bg-${detail.type === 'success' ? 'success' : detail.type === 'error' ? 'danger' : 'warning'} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">${detail.message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            const container = document.getElementById('toast-container');
            container.insertAdjacentHTML('beforeend', toastHtml);
            const toastEl = container.lastElementChild;
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
            toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
        });

        // Close modal handler
        function closeModal() {
            const container = document.getElementById('modal-container');
            container.innerHTML = '';
        }

        // Download config file
        function downloadConfig(username) {
            fetch('/users/' + encodeURIComponent(username) + '/config/download')
                .then(response => response.text())
                .then(data => {
                    const blob = new Blob([data], { type: 'text/plain' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = username + '.ovpn';
                    link.click();
                    URL.revokeObjectURL(link.href);
                });
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                document.body.dispatchEvent(new CustomEvent('showToast', {
                    detail: { message: 'Copied to clipboard', type: 'success' }
                }));
            });
        }

        // Handle HTMX response errors
        document.body.addEventListener('htmx:responseError', function(e) {
            document.body.dispatchEvent(new CustomEvent('showToast', {
                detail: { message: 'Error: ' + e.detail.xhr.responseText, type: 'error' }
            }));
        });
    </script>
</body>
</html>
{{end}}
